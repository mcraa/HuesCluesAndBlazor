@page "/board"

@using Microsoft.AspNetCore.WebUtilities

@inject NavigationManager NavigationManager

<PageTitle>HuesClues - Board</PageTitle>

<div class="tiles-container">

    @for(int i=0; i<=_colorsCount; ++i) {        
        <div class="color-row">
            @for(int j=0; j<=_colorsCount; ++j) {
                if (i == 0 && j != 0) {
                    <span class="color-tile">  @(Convert.ToChar(j + 64))  </span>
                } else {
                    if (j == 0 && i != 0) {
                        <span class="color-tile">  @(i)  </span>
                    } else {
                        <span 
                            class="color-tile" 
                            style=@($"color: {GetHslForCoordinate(i,j)}; background-color: {GetHslForCoordinate(i,j)}")
                        > 
                            [@i.ToString("00"), @j] 
                        </span>
                    }
                }
            }
        </div>
    }
</div>

@if (true) {}

@code {
    
    protected override void OnInitialized() {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);

        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue(nameof(ColorsCount), out var value))
        {
            ColorsCount = value.First();
        }

        if (!string.IsNullOrEmpty(ColorsCount) && Int32.TryParse(ColorsCount, out int ccnt)) 
        {
            _colorsCount = ccnt;
        } 
    }

    [Parameter]
    public string? ColorsCount { get; set; }
    
    private int _colorsCount { get; set; } = 16;

    public string GetHslForCoordinate(int x, int y) {
        
        return $"hsl({x * 360 / _colorsCount }, {y * 100 / _colorsCount}%, {(2 * _colorsCount - (y+x)) * 97 / _colorsCount / 2}%)";
    }
 
}
